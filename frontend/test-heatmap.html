<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Mapas de Calor - 12 Zonas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .heatmap-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .heatmap-title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }
        
        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        
        .heatmap-canvas {
            border: 4px solid #ffffff;
            border-radius: 8px;
            background: #2a7f3e;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            display: block;
            position: relative;
            z-index: 1;
        }
        
        .legend {
            display: flex;
            justify-content: space-around;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .stats {
            margin-top: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
        }
        
        .zone-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .zone-stat {
            background: white;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
        }
        
        .zone-number {
            font-weight: bold;
            color: #007bff;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .status.loading {
            background: #cce5ff;
            color: #004085;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèë Prueba Sistema de Mapas de Calor</h1>
            <h2>12 Zonas T√°cticas</h2>
            <p>Demostraci√≥n del nuevo sistema de an√°lisis con 12 sectores</p>
        </div>
        
        <div class="controls">
            <button onclick="generateHeatmaps()">Generar Mapas de Calor</button>
            <button onclick="exportHeatmaps()" id="exportBtn" disabled>Exportar PNG</button>
            <button onclick="clearHeatmaps()">Limpiar</button>
            <button onclick="toggleZoneNumbers()">Mostrar/Ocultar N√∫meros</button>
        </div>
        
        <div id="status"></div>
        
        <div class="heatmap-grid">
            <div class="heatmap-card">
                <div class="heatmap-title">üü¢ Recuperaci√≥n de Bochas</div>
                <div class="canvas-container">
                    <canvas id="recoveryCanvas" class="heatmap-canvas" width="300" height="200"></canvas>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(0,200,100,0.3);"></div>
                        <span>Bajo</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(0,200,100,0.6);"></div>
                        <span>Medio</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(0,200,100,0.9);"></div>
                        <span>Alto</span>
                    </div>
                </div>
            </div>
            
            <div class="heatmap-card">
                <div class="heatmap-title">üî¥ P√©rdida de Bochas</div>
                <div class="canvas-container">
                    <canvas id="lossCanvas" class="heatmap-canvas" width="300" height="200"></canvas>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(255,50,50,0.3);"></div>
                        <span>Pocas</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(255,50,50,0.6);"></div>
                        <span>Moderadas</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(255,50,50,0.9);"></div>
                        <span>Muchas</span>
                    </div>
                </div>
            </div>
            
            <div class="heatmap-card">
                <div class="heatmap-title">üîµ Actividad General</div>
                <div class="canvas-container">
                    <canvas id="generalCanvas" class="heatmap-canvas" width="300" height="200"></canvas>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(50,150,255,0.3);"></div>
                        <span>Baja</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(50,150,255,0.6);"></div>
                        <span>Media</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(50,150,255,0.9);"></div>
                        <span>Alta</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="stats">
            <h3>üìä Estad√≠sticas por Zona</h3>
            <div class="zone-stats" id="zoneStatsContainer">
                <!-- Se generan din√°micamente -->
            </div>
        </div>
    </div>

    <script type="module">
        import { HeatmapGenerator } from './js/heatmap-generator.js';
        import { sampleHeatmapData, generateSummaryStats } from './js/heatmap-sample-data.js';
        
        let generators = {};
        
        // Inicializar al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Inicializando mapas de calor...');
            
            try {
                generators.recovery = new HeatmapGenerator('recoveryCanvas');
                generators.loss = new HeatmapGenerator('lossCanvas');
                generators.general = new HeatmapGenerator('generalCanvas');
                
                // Configurar para mostrar grid de zonas
                generators.recovery.options.showGrid = true;
                generators.loss.options.showGrid = true;
                generators.general.options.showGrid = true;
                
                console.log('Generadores creados:', generators);
                
                // Dibujar campos vac√≠os
                Object.values(generators).forEach(gen => {
                    console.log('Dibujando campo para generador:', gen);
                    gen.drawField();
                });
                
                initializeZoneStats();
                showStatus('Sistema listo para generar mapas de calor', 'success');
                
            } catch (error) {
                console.error('Error inicializando:', error);
                showStatus('Error al inicializar el sistema: ' + error.message, 'error');
            }
        });
        
        window.generateHeatmaps = async function() {
            showStatus('Generando mapas de calor...', 'loading');
            
            try {
                // Simular delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Generar mapa de recuperaci√≥n
                generators.recovery.generateHeatmap(sampleHeatmapData.recoveryData, 'Recuperaci√≥n Bocha');
                
                // Generar mapa de p√©rdida
                generators.loss.generateHeatmap(sampleHeatmapData.lossData, 'P√©rdida Bocha');
                
                // Generar mapa general
                generators.general.generateHeatmap(sampleHeatmapData.generalData, 'general');
                
                // Actualizar estad√≠sticas
                updateZoneStats(sampleHeatmapData.generalData);
                
                document.getElementById('exportBtn').disabled = false;
                showStatus('Mapas de calor generados correctamente', 'success');
                
            } catch (error) {
                console.error('Error generando mapas:', error);
                showStatus('Error al generar mapas de calor', 'error');
            }
        };
        
        window.exportHeatmaps = function() {
            try {
                generators.recovery.exportAsPNG('recuperacion_bochas.png');
                generators.loss.exportAsPNG('perdida_bochas.png');
                generators.general.exportAsPNG('actividad_general.png');
                
                showStatus('Mapas exportados como PNG', 'success');
            } catch (error) {
                console.error('Error exportando:', error);
                showStatus('Error al exportar mapas', 'error');
            }
        };
        
        window.clearHeatmaps = function() {
            Object.values(generators).forEach(gen => {
                gen.drawField();
            });
            
            initializeZoneStats();
            document.getElementById('exportBtn').disabled = true;
            showStatus('Mapas limpiados', 'success');
        };
        
        window.toggleZoneNumbers = function() {
            Object.values(generators).forEach(gen => {
                gen.options.showLabels = !gen.options.showLabels;
                gen.drawField();
            });
        };
        
        function initializeZoneStats() {
            const container = document.getElementById('zoneStatsContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= 12; i++) {
                const div = document.createElement('div');
                div.className = 'zone-stat';
                div.innerHTML = `
                    <div class="zone-number">Zona ${i}</div>
                    <div id="zone-${i}-stat">0 acciones</div>
                `;
                container.appendChild(div);
            }
        }
        
        function updateZoneStats(data) {
            data.forEach(item => {
                const zone = parseInt(item.zone_number);
                const count = parseInt(item.action_count) || 0;
                const element = document.getElementById(`zone-${zone}-stat`);
                if (element) {
                    element.textContent = `${count} acciones`;
                }
            });
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.textContent = '';
                    statusDiv.className = '';
                }, 3000);
            }
        }
    </script>
</body>
</html>
